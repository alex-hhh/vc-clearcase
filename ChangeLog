2005-10-07  Alexandru Harsanyi  <harsanyi@mac.com>

	* vc-clearcase.el (vc-clearcase-list-checkouts): 1.54 set the
	default directory of the *clearcase-lsco* buffer to the directory
	being searched for checkouts.

2005-09-09  Alexandru Harsanyi  <harsanyi@mac.com>

	* vc-clearcase.el (vc-clearcase-create-snapshot): 1.53 call
	expand-file-name on dir before using it.

2005-08-24  Alexandru Harsanyi  <harsanyi@mac.com>

	* vc-clearcase.el (vc-clearcase-gui-vtree-browser)
	(vc-clearcase-list-checkouts, vc-clearcase-update-view)
	(vc-clearcase-label-diff-report)
	(vc-clearcase-list-view-private-files): 1.52 use expand-file-name

2005-08-12  Alexandru Harsanyi  <harsanyi@mac.com>

	* vc-clearcase.el: 1.51 validated the file using checkdoc.  All
	comments and strings are spellchecked.  Converted the file from
	using folding.el to outline-minor for outlining.

2005-08-11  Alexandru Harsanyi  <harsanyi@mac.com>

	* vc-clearcase.el (with-comment-file): 1.48 check input arguments
	and evaluate them only once.

2005-08-08  Alexandru Harsanyi  <harsanyi@mac.com>

	* vc-clearcase.el: 1.47 only require cc-defs at compile time.

2005-08-05  Alexandru Harsanyi  <harsanyi@mac.com>

	* vc-clearcase.el: 1.45 installation instructions updated.  all
	the keymaps (including menus) are autoloaded.  added (autoloaded)
	code to update vc-handled-backends with the CLEARCASE tag.
	(vc-clearcase-registered): 1.45 a simple version of the function
	is autoloaded, will only load the vc-clearcase package if needed.
	(ah-clearcase-cleartool-program, vc-clearcase-what-version)
	(vc-clearcase-what-rule, vc-clearcase-what-view-tag)
	(vc-clearcase-gui-vtree-browser, vc-clearcase-list-checkouts)
	(vc-clearcase-update-view, vc-clearcase-edcs): 1.45 added an
	autoload cookie.
	(vc-clearcase-label-diff-report): 1.45 renamed from
	ah-clearcase-label-diff-report, plus added an autoloaded cookie.
	(vc-clearcase-list-view-private-files): 1.45 renamed from
	ah-clearcase-list-view-private-files, plus added an autoloaded
	cookie.
	(ah-clearcase-log-view-mode): 1.46 reindented.

2005-07-28  Alexandru Harsanyi  <harsanyi@mac.com>

	* vc-clearcase.el (ah-cleartool-save-stop-data): 1.44 now a
	defcustom variable.

2005-07-20  Alexandru Harsanyi  <harsanyi@mac.com>

	* vc-clearcase.el (ah-clearcase-log-view-forward-version): 1.43
	new function.
	(ah-clearcase-log-view-backward-version): 1.43 new function.
	(ah-clearcase-log-view-mode-map): 1.43 keymap updated with new
	functions.
	(ah-clearcase-fprop): 1.43 added revision-list as a new slot.
	(ah-clearcase-fprop-reset): 1.43 reset revision-list
	(ah-clearcase-maybe-set-vc-state): 1.43 use %Vn to get the
	version (instead of %Sn).
	(vc-clearcase-registered): 1.43 use %Vn and %PVn instead of %Sn
	and %PSn to get the version and parent version.
	(vc-clearcase-dir-state): 1.43 use %Vn instead of %Sn.
	(ah-clearcase-revision-reserved-p): 1.43 use %PVn instead of %PSn.
	(vc-clearcase-print-log): 1.43 call vc-setup-buffer on the log
	buffer.
	(vc-clearcase-show-log-entry): 1.43 bugfix in the regexp that
	searches for the revision.
	(vc-clearcase-annotate-command): 1.43 call vc-setup-buffer on
	`buf'
	(ah-clearcase-annotate-post-process): 1.43 use a simpler regexp to
	match the revision.
	(vc-clearcase-previous-version): 1.43 new function.
	(vc-clearcase-next-version): 1.43 new function.

2005-07-19  Alexandru Harsanyi  <harsanyi@mac.com>

	* vc-clearcase.el most of the changes below represent porting to
	Emacs 22.
	(ah-cleartool-tq-handler): 1.41 use string-to-number instead of
	string-to-int.
	(with-comment-file): 1.41 now takes an argument for the
	comment-file and binds the file name to that.  Also re-written to
	use with-temp-file.  All callers updated.
	(vc-version-backup-file-name): 1.41 the advice now runs after the
	function and modifies the result.
	(ah-clearcase-find-version-helper): 1.41 new function.
	(vc-clearcase-find-version): 1.41 new function.
	(vc-clearcase-checkout): 1.41 use a simplified implementation.
	(vc-clearcase-annotate-command): 1.41 the fmt string passed to
	cleartool now asks for the full revision instead of only the first
	20 characters of it.
	(vc-clearcase-annotate-time): 1.41 new function.
	(vc-clearcase-annotate-extract-revision-at-line): 1.41 new
	function.
	(ah-clearcase-annotate-mktime): 1.41 renamed from
	ah-clearcase-annotate-mk-age, callers updated.  Semantics also
	changed to return the number of day as a fraction.
	(ah-clearcase-annotate-post-process): 1.41 renamed from
	ah-clearcase-annotate-age-buffer, callers updated.  It now
	computes the time, age and version of each line in the buffer plus
	re-formats the buffer.
	(ah-clearcase-annotate-mark-deleted): 1.41 bind inhibit-read-only
	to t.
	(with-comment-file): 1.42 bugfix: remove the file named in the
	variable specified by the user instead of hardcodin it to
	comment-file.

2005-07-12  Alexandru Harsanyi  <harsanyi@mac.com>

	* vc-clearcase.el (ah-clearcase-finish-checkout): 1.40 pass -ptime
	parameter to the checkout command.

2005-04-02  Alexandru Harsanyi  <harsanyi@mac.com>

	* vc-clearcase.el (ah-clearcase-log-view-again): 1.38 erase the
	buffer before running the cleartool command.

2005-03-31  Alexandru Harsanyi  <harsanyi@mac.com>

	* vc-clearcase.el (vc-clearcase): 1.37 toplevel customize group
	added.
	(ah-clearcase-cleartool-program): 1.37 new customize variable.
	(ah-clearcase-vtree-program, ah-cleartool-timeout,
	ah-cleartool-idle-timeout, ah-clearcase-diff-format,
	ah-clearcase-diff-cleanup-flag): 1.37 changed to customize
	variables.
	(ah-cleartool-tq-start, ah-cleartool-do): 1.37 use
	ah-clearcase-cleartool-program instead of the hardcoded
	"cleartool"
	(ah-clearcase-diff-cleanup-flag): 1.37

2005-03-21  Alexandru Harsanyi  <harsanyi@mac.com>

	* vc-clearcase.el (vc-clearcase-checkout): 1.36 bugfix: checking
	out a revision that is not latest.
	(vc-clearcase-merge, vc-clearcase-merge-news): 1.36 bugfix: return
	0 as success

2005-03-10  Alexandru Harsanyi  <harsanyi@mac.com>

	* vc-clearcase.el (ah-cleartool-signal-error): 1.35 handle the
	case when POS is nil

2005-03-02  Alexandru Harsanyi  <harsanyi@mac.com>

	* vc-clearcase.el (vc-clearcase-update-view): 1.34 strip directory
	path of the last slash, it seems cleartool cannot update a
	directory if this is the toplevel VOB name and ends in a slash.
	(with-comment-file): 1.34 use temporary-file-directory
	(vc-clearcase-edcs): 1.34 use temporary-file-directory

2005-02-15  Alexandru Harsanyi  <harsanyi@mac.com>

	* vc-clearcase.el (ah-cleartool-signal-error): 1.33 new function.
	(ah-cleartool-wait-for): 1.33 call ah-cleartool-signal-error
	instead of just error.
	(ah-clearcase-all-vprops): 1.33 use a list instead of a hash-table
	(ah-clearcase-vprop-get): 1.33 updated to use a list for
	ah-clearcase-all-vprops
	(ignore-cleartool-errors): 1.33 new macro
	(vc-clearcase-registered): 1.33 use ignore-cleartool-errors
	(vc-clearcase-responsible-p): 1.33 only trap ah-cleartool-error in
	the condition-case
	(vc-clearcase-create-snapshot): 1.33 only trap ah-cleartool-error
	in the condition-case, use ignore-cleartool-errors

2005-01-26  Alexandru Harsanyi  <harsanyi@mac.com>

	* vc-clearcase.el (ah-clearcase-label-diff-report): 1.32 use
	accept-process-output in the wait loop

2005-01-17  Alexandru Harsanyi  <harsanyi@mac.com>

	* vc-clearcase.el (ah-clearcase-fprop-set-version): 1.31 use the
	case form
	(ah-clearcase-vprop-get): 1.31 try to determine if the view is
	dynamic.  For dynamic views ah-clearcase-declare-view is no longer
	needed.
	(vc-clearcase-diff): 1.31 use the ecase form.
	(vc-clearcase-what-version): 1.31 use the case form
	(ah-clearcase-setcs): 1.31 use the case form

2004-12-29  Alexandru Harsanyi  <harsanyi@mac.com>

	* vc-clearcase.el (ah-cleartool-tq-start): 1.30 on non windows
	systems, wait for the cleartool prompt, erase it from the process
	buffer and only than start the transaction queue.  This avoids a
	'spurious' error from the tq package when we start it.
	(ah-cleartool-wait-for): 1.30 only call sit-for when the
	transaction is not complete -- response time is much improved this
	way.  Also the code for processing the resut has been rewriten to
	avoid unnecessary operations.
	Indentation information for the with-checkedout-dir and
	with-comment-file is now at the end of the file, to be eval-ed
	when the file is loaded.

2004-12-26  Alexandru Harsanyi  <harsanyi@mac.com>

	* vc-clearcase.el (ah-cleartool-idle-timeout): 1.29 increased to
	15 minutes
	(ah-cleartool-wait-for): 1.29 assert that tid is not nil at the
	begining; also call sit-for in the inner loop, see comment inside
	function for the reason.
	(ah-clearcase-label-diff-report): 1.29 start with default values
	for the length of the report columns, this produces a more
	pleasing result when the report is empty or the labels are longer
	than any version in the report

2004-12-23  Alexandru Harsanyi  <harsanyi@mac.com>

	* vc-clearcase.el (ah-cleartool-wait-for): 1.28 rewrote code that
	waits for the transaction to complete, uses accept-process-output.
	Works better on Solaris ClearCase.

2004-12-01  Alexandru Harsanyi  <harsanyi@mac.com>

	* vc-clearcase.el (ah-clearcase-label-diff-report): 1.27 bugfix:
	wait until both cleartool processes finished (used to wait until
	one of them finished, an 'and' was replaced by an 'or')

2004-11-28  Alexandru Harsanyi  <harsanyi@mac.com>

	* vc-clearcase.el (ah-clearcase-fprop-checkout-will-branch-p):
	1.26 new function.
	(vc-clearcase-state-needs-update): no longer needed.
	(vc-clearcase-state): 1.26 vc-clearcase-state-heuristic now
	returns full state info, no longer need to run a cleartool update.
	(vc-clearcase-state-heuristic): 1.26 now computes the full
	clearcase state (for the purposes of vc-clearcase.el).  In
	particular, the needs-patch case is also detected.
	(vc-clearcase-checkout): 1.26 use
	ah-clearcase-fprop-checkout-will-branch-p

2004-11-17  Alexandru Harsanyi  <harsanyi@mac.com>

	* vc-clearcase.el (ah-annotate-show-color-map): 1.25 removed, as
	it is not a clearcase specific function.

2004-11-12  Alexandru Harsanyi  <harsanyi@mac.com>

	* vc-clearcase.el (ah-clearcase-list-view-private-files): 1.24 new
	function.

2004-11-04  Alexandru Harsanyi  <harsanyi@mac.com>

	* vc-clearcase.el: 1.23 checked spelling of all comments
	(ah-cleartool-save-stop-data): 1.23 make it a defvar.  Not sure
	why it was defined as a function.
	(ah-cleartool-tq-stop): 1.23 ah-cleartool-save-stop-data is no
	longer a function.
	(ah-cleartool-ask): 1.23 don't print abort information when
	clearool is timed out.
	(vc-clearcase-workfile-unchanged-p): 1.23 different
	implementation, as the -status_only option to cleardiff does not
	work.
	(vc-clearcase-register): 1.23 double the timeout for the mkelem
	command.  It seems to fail all the time.
	(vc-clearcase-checkout): 1.23 accept (eq rev t) as a request to
	uptate to latest version.  Update version info when we've updated
	the file.
	(vc-clearcase-diff): 1.23 don't use replace-regexp, its
	documentation said it is not designed for lisp programs.

2004-10-16  Alexandru Harsanyi  <harsanyi@mac.com>

	* vc-clearcase.el (ah-cleartool-idle-timeout): 1.22 new variable.
	(ah-cleartool-last-command-timestamp): 1.22 new variable
	(ah-cleartool-tq-start): 1.22 initialize
	ah-cleartool-last-command-timestamp to current time
	(ah-cleartool-tq-stop): 1.22 really insert a form feed this time;
	insert the value of ah-cleartool-ntid as well.
	(ah-cleartool-ask): 1.22 restart cleartool if it was idle for more
	than ah-cleartool-idle-timeout seconds.

2004-10-08  Alexandru Harsanyi  <harsanyi@mac.com>

	* vc-clearcase.el (ah-cleartool-save-stop-data): 1.21 new
	variable, used for debugging mysterious timeouts in cleartool
	(ah-cleartool-tq-stop): 1.21 when ah-cleartool-save-stop-data is
	not nil, we save the contents of the tq buffer plus some state
	info to the *cleartool-aborts* buffer.
	(ah-cleartool-wait-for): 1.21 the wait strategy has changed, we
	only timeout if cleartool has not written anything to the
	tq-buffer in ah-cleartool-timeout seconds.
	(vc-clearcase-workfile-unchanged-p): 1.21 use the -status_only
	option to the cleartool diff command, more efficient this way.

2004-09-30  Alexandru Harsanyi  <harsanyi@mac.com>

	* vc-clearcase.el (vc-clearcase-create-snapshot): 1.20 use
	file-name-directory on DIR, as it might be a file.

2004-09-29  Alexandru Harsanyi  <harsanyi@mac.com>

	* vc-clearcase.el (ah-cleartool-wait-for): 1.19 comment update.
	(ah-clearcase-vprop-prepare): 1.19 use the extended semantics of
	ah-clearcase-vprop-get
	(ah-clearcase-finish-checkout): 1.19 use a format string for the
	checkout command, plus increase the cleartool timeout by 50% when
	running it.
	(vc-clearcase-create-snapshot): 1.19 change to the snapshot
	directory before running the command to avoid a complaint from
	cleartool that the pathname is not within a VOB.

2004-09-21  Alexandru Harsanyi  <harsanyi@mac.com>

	* vc-clearcase.el (ah-clearcase-label-diff-report): 1.18 variables
	from the ps-print package are declared special, to avoid a
	compiler warning.  Also set them using set on the result of
	make-local-variable (code is more compact this way).

2004-09-20  Alexandru Harsanyi  <harsanyi@mac.com>

	* vc-clearcase.el (ah-cleartool-status-rx): 1.17 don't match the
	end of line $ as we might have two answers in the buffer and it
	will match the later.
	(ah-cleartool-wait-for): 1.17 re-written to use a with-timeout
	form when waiting for the transaction to complete.

2004-09-19  Alexandru Harsanyi  <harsanyi@mac.com>

	* vc-clearcase.el (ah-clearcase-fprop): 1.15 add a 'broken-view
	checkout type
	(ah-clearcase-fprop-broken-view-p): 1.15 the fprop struct hoolds
	the broken-view state internally, so just return that.
	(ah-clearcase-fprop-set-version): 1.15 don't update the checkout
	status or modeline when the file is hijacked or is in a broken
	view.
	(ah-clearcase-fprop-set-version-simple): 1.15 check for a broken
	view as well.
	(ah-clearcase-fprop): 1.16 checkout slot renamed to status
	(ah-clearcase-fprop-hijacked-p, ah-clearcase-fprop-checkedout-p,
	ah-clearcase-fprop-broken-view-p, ah-clearcase-fprop-set-version,
	ah-clearcase-fprop-set-version-simple, vc-clearcase-what-version):
	1.16 use ah-clearcase-fprop-status
	(ah-clearcase-vprop-get): 1.16 rewritten to accept a vprop, a
	fprop or a string as an argument, and find the correct vprop from
	any of these.
	(ah-clearcase-snapshot-view-p, ah-clearcase-dynamic-view-p): 1.16
	made it a defsubst, ah-clearcase-vprop-get is smarter now.
	(vc-clearcase-what-version): 1.16 added info about a broken view.

2004-09-17  Alexandru Harsanyi  <harsanyi@mac.com>

	* vc-clearcase.el (ah-cleartool-status-rx): 1.14 match only at the
	end of the string.
	(ah-cleartool-question-rx): 1.14 new regexp
	(ah-cleartool-tq-rx): 1.14 combines ah-cleartool-status-rx and
	ah-cleartool-question-rx, used by the transaction queue to
	determine the end of record from cleartool.
	(ah-cleartool-tq-handler): 1.14 try ah-cleartool-status-rx, than
	ah-cleartool-question-rx, and report an error if the latter
	matches.  Also removed the save-match-data form as Emacs already
	saves these.
	(ah-cleartool-ask): 1.14 use ah-cleartool-tq-rx as the end of
	record regexp.
	(ah-clearcase-fprop-broken-view-p): 1.14 new function
	(ah-clearcase-snapshot-view-p, ah-clearcase-dynamic-view-p): 1.14
	accept a fprop as argument in addition to a vprop or a view-tag
	name.
	(vc-clearcase-state): 1.14 don't run cleartool update if the view
	is broken, instead report an error.
	(vc-clearcase-dir-state): 1.14 use new semantics of
	ah-clearcase-snapshot-view-p

2004-09-16  Alexandru Harsanyi  <harsanyi@mac.com>

	* vc-clearcase.el (ah-cleartool-tq-handler): 1.13 use = instead of
	eq
	(ah-clearcase-fprop-set-version): 1.13 use null instead of eq
	(ah-clearcase-vprop-prepare): 1.13 use char-equal instead of eq
	(ah-clearcase-refresh-files-in-view): 1.13 renamed view to
	view-tag
	(vc-clearcase-create-snapshot): 1.13 use format to create the
	cleartool command, quote dir properly
	(vc-clearcase-list-checkouts): 1.13 use string= instead of equal
	(ah-clearcase-label-diff-report): 1.13 new function
	(vc-clearcase-edcs): 1.13 disable undo when inserting the
	configspec, re-enable it afterwards.
	(clearcase-global-menu): 1.13 add ah-clearcase-label-diff-report
	to the Clearcase menu.

2004-09-10  Alexandru Harsanyi  <harsanyi@mac.com>

	* vc-clearcase.el (ah-clearcase-fprop-initialized-p): 1.12 made it
	a defsubst
	(vc-clearcase-checkout): 1.12 if the checkout will create a
	branch, don't check if someone else has a reserved checkout on the
	version.
	(vc-clearcase-diff): 1.12 determine whether the diff is empty
	depends on the diff type: serial or diff

2004-09-05  Alexandru Harsanyi  <harsanyi@mac.com>

	* vc-clearcase.el (ah-cleartool-tq-maybe-start,
	ah-clearcase-fprop-file, ah-clearcase-fprop-hijacked-p,
	ah-clearcase-fprop-checkedout-p): 1.11 made them a defsubst

2004-09-03  Alexandru Harsanyi  <harsanyi@mac.com>

	* vc-clearcase.el (ah-clearcase-vtree-program): 1.10 new variable
	(vc-clearcase-create-snapshot): reuse BRANCHP to signify that the
	label should be moved.
	(vc-clearcase-gui-vtree-browser): 1.10 use
	ah-clearcase-vtree-program

2004-08-30  Alexandru Harsanyi  <harsanyi@mac.com>

	* vc-clearcase.el (ah-clearcase-declare-view,
	ah-clearcase-refresh-files-in-view): 1.9 use the same name in the
	body as in the parameter declaration (for some reason, the CVS
	Emacs byte compiler didn't pick this)

2004-08-29  Alexandru Harsanyi  <harsanyi@mac.com>

	* vc-clearcase.el (vc-clearcase-checkout): 1.8 use format to
	construct the checkout command

2004-08-24  Alexandru Harsanyi  <harsanyi@mac.com>

	* vc-clearcase.el: 1.7 commentary moved inside a fold, some
	functions moved around for better code structure
	(ah-clearcase-refresh-files-in-view): 1.7 renamed from
	ah-clearcase-after-setcs
	(edcs-mode): 1.7 defined as an alias for ah-clearcase-edcs-mode.
	(clearcase-global-menu): 1.7 Non file Clearcase commands go in
	here instead of the Version Control menu.

2004-08-22  Alexandru Harsanyi  <harsanyi@mac.com>

	* vc-clearcase.el: 1.6 TODO list update
	(ah-clearcase-wash-mode-line): 1.6 new function
	(ah-clearcase-fprop-set-version): 1.6 use
	ah-clearcase-wash-mode-line, don't add '.../' to the mode-line
	string
	(ah-clearcase-vprop-prepare): 1.6 rewritten
	(ah-clearcase-diff-format, ah-clearcase-diff-cleanup-flag): 1.6
	new variables
	(vc-clearcase-diff): 1.6 use ah-clearcase-diff-format and
	ah-clearcase-diff-cleanup-flag
	(vc-clearcase-what-version): 1.6 new function
	(ah-clearcase-view-tag-complete): 1.6 use compare-string instead
	of string= and substring
	(vc-clearcase-edcs): 1.6 don't remove the old view-tag list

2004-08-15  Alexandru Harsanyi  <harsanyi@mac.com>

	* vc-clearcase.el (with-checkedout-dir, with-comment-file): 1.5
	found out about ,@
	(ah-clearcase-edcs-mode): 1.5 add syntax codes for the comment
	character and setup comment-start & co

2004-08-14  Alexandru Harsanyi  <harsanyi@mac.com>

	* vc-clearcase.el: 1.3 all packages are required at runtime
	(ah-clearcase-fprop-initialized-p): 1.3 doc update
	(ah-clearcase-fprop-reset): 1.3 accepts a NIL fprop, doc update
	(ah-clearcase-fprop-set-version): 1.3 set version info for
	hijacked files as well but omit the checkout mode and mode line
	(ah-clearcase-fprop-set-version-simple): 1.3 set basic information
	even for hijacked files.
	(ah-clearcase-snapshot-view-p): 1.3 reorganized
	(ah-clearcase-dynamic-view-p): 1.3 new function
	(ah-clearcase-vprop-prepare, ah-clearcase-maybe-set-vc-state,
	vc-clearcase-registered, vc-clearcase-state,
	vc-clearcase-dir-state, vc-clearcase-responsible-p,
	vc-clearcase-checkin, ah-clearcase-revision-reserved-p,
	vc-clearcase-checkout, vc-clearcase-revert, vc-clearcase-merge,
	vc-clearcase-merge-news, vc-clearcase-diff): 1.3 the cleartool
	command is constructed using a format string.  Accepts filenames
	containing spaces.
	(ah-clearcase-vprop-prepare): 1.3 fix test for view type (snapshot
	or dynamic)
	(ah-clearcase-gensym-prefix): 1.3 new variable
	(with-checkedout-dir): 1.3 new macro
	(with-comment-file): 1.3 new macro
	(vc-clearcase-registered): 1.3 when the file is hijacked, ask
	cleartool for information using the version extended pathname.
	(vc-clearcase-register, vc-clearcase-rename-file): 1.3 use
	with-checkedout-dir
	(ah-clearcase-finish-checkout): 1.3 quote pname
	(vc-clearcase-rename-file): 1.3 use
	ah-clearcase-with-checked-out-dir
	(ah-clearcase-edcs-mode): 1.3 fix typo in name
	(vc-clearcase-edcs): 1.3 don't wait for the previous lsview
	transaction.
	(ah-clearcase-tmpdir): 1.3 new variable
	(vc-clearcase-checkin, ah-clearcase-finish-checkout,
	vc-clearcase-rename-file): 1.3 use with-comment-file
